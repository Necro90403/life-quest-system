<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Quest System</title>
    
    <!-- Custom Favicon - Replace 'PP.png' with the actual path to your uploaded image -->
    <link rel="icon" type="image/png" href="PP.png">
    <link rel="apple-touch-icon" href="PP.png">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a0e17">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Life Quest">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Exo+2:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e17;
            --bg-panel: #131820;
            --bg-card: #1a1f2e;
            --accent-primary: #00d4ff;
            --accent-secondary: #7c3aed;
            --accent-gold: #ffd700;
            --text-primary: #e8eef5;
            --text-secondary: #9ca3af;
            --success: #10b981;
            --danger: #ef4444;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(124, 58, 237, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-box h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .login-box p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            background: white;
            color: #333;
            padding: 1rem 2rem;
            border-radius: 8px;
            border: none;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .google-icon {
            width: 20px;
            height: 20px;
        }

        /* Setup Screen */
        .setup-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 23, 0.95);
            z-index: 999;
            overflow-y: auto;
            padding: 2rem;
        }

        .setup-box {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            margin: 2rem auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .setup-box h2 {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--accent-primary);
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .header-left {
            flex: 1;
        }

        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.3)); }
            50% { filter: drop-shadow(0 0 30px rgba(124, 58, 237, 0.5)); }
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--bg-panel);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--accent-primary);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-email {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stats-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .player-level {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .level-display {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .level-label {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .xp-bar {
            margin-top: 1.5rem;
        }

        .xp-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .xp-progress {
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .stat-item {
            margin-bottom: 1.5rem;
        }

        .stat-name {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-value {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .stat-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .weight-tracker {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .weight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .weight-title {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .weight-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weight-stat {
            flex: 1;
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
        }

        .weight-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .weight-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .weight-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .weight-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent-primary));
            transition: width 0.5s ease;
        }

        .weight-input-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .weight-input-group input {
            flex: 1;
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 6px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .quests-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .work-schedule-banner {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(0, 212, 255, 0.2));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 1.5rem;
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .work-schedule-banner.active {
            display: flex;
        }

        .work-icon {
            font-size: 2rem;
        }

        .work-schedule-input {
            margin-bottom: 1.5rem;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .input-field {
            flex: 1;
            min-width: 150px;
        }

        .input-field label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-field input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-clear {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
        }

        .btn-clear:hover {
            background: var(--danger);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
        }

        .quest-category {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .category-icon {
            font-size: 1.5rem;
        }

        .category-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 600;
            flex: 1;
        }

        .category-progress {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .quest-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quest-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .quest-item.completed {
            opacity: 0.6;
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        .quest-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .quest-item.completed .quest-checkbox {
            background: var(--success);
            border-color: var(--success);
        }

        .quest-checkbox::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quest-item.completed .quest-checkbox::after {
            opacity: 1;
        }

        .quest-content {
            flex: 1;
        }

        .quest-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .quest-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .quest-xp {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--accent-primary);
            border-radius: 6px;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .streak-display {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .streak-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .streak-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }

        /* Calendar Heatmap */
        .calendar-section {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .calendar-header {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            border-color: var(--accent-primary);
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .calendar-day-percentage {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .calendar-day.perfect {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            border-color: var(--danger);
            color: white;
        }

        .calendar-day.high {
            background: rgba(255, 107, 107, 0.6);
            border-color: rgba(239, 68, 68, 0.8);
        }

        .calendar-day.medium {
            background: rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.6);
        }

        .calendar-day.low {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.4);
        }

        /* Daily Report Modal */
        .daily-report-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 23, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .daily-report-modal.active {
            display: flex;
        }

        .daily-report {
            background: var(--bg-panel);
            border: 2px solid var(--accent-primary);
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: reportAppear 0.5s ease;
        }

        @keyframes reportAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .daily-report h2 {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-align: center;
        }

        .report-date {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .report-section {
            margin-bottom: 2rem;
        }

        .report-section h3 {
            font-size: 1.25rem;
            color: var(--accent-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .report-stat-label {
            color: var(--text-secondary);
        }

        .report-stat-value {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--accent-primary);
        }

        .motivation-message {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(124, 58, 237, 0.1));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .close-report-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .close-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .daily-summary {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .summary-stat {
            margin-bottom: 1.5rem;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .summary-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .disabled-quest {
            opacity: 0.3;
            pointer-events: none;
        }

        /* Calorie Tracker Styles */
        .calorie-tracker {
            margin-top: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-dark);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .calorie-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .calorie-input {
            flex: 1;
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.875rem;
        }

        .calorie-display {
            font-size: 0.875rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
        }

        .calorie-total {
            font-weight: 600;
            color: var(--accent-primary);
        }

        /* Calendar Navigation Styles */
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .calendar-month-display {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .calendar-nav-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            border-color: var(--accent-primary);
            background: var(--bg-panel);
        }

        .calendar-day-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day.today {
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        /* Notification Settings Styles */
        .notification-settings {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .notification-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-card);
            border-radius: 13px;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-color: var(--accent-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 26px;
        }

        .notification-time-select {
            margin-top: 1rem;
        }

        .notification-time-select label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .notification-time-select input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
        }

        /* Weekly Quests Styles */
        .weekly-quests-section {
            background: var(--bg-panel);
            border: 2px solid var(--accent-secondary);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.3);
        }

        .weekly-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .weekly-title {
            font-family: 'Cinzel', serif;
            font-size: 1.75rem;
            color: var(--accent-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .weekly-reset-timer {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: right;
        }

        .weekly-reset-timer strong {
            color: var(--accent-secondary);
            display: block;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .weekly-quest-item {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .weekly-quest-item:hover {
            border-color: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(124, 58, 237, 0.2);
        }

        .weekly-quest-item.completed {
            background: rgba(124, 58, 237, 0.1);
            border-color: var(--accent-secondary);
            opacity: 0.8;
        }

        .weekly-quest-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .weekly-quest-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-secondary);
            flex: 1;
        }

        .weekly-quest-xp {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-primary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
        }

        .weekly-quest-description {
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .weekly-quest-category {
            display: inline-block;
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--accent-secondary);
            color: var(--accent-secondary);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .weekly-progress-bar {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .weekly-progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .weekly-progress-fill {
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            overflow: hidden;
        }

        .weekly-progress-fill-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.5);
        }

        /* Achievements & Badges Styles */
        .achievements-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .achievements-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .achievements-title {
            font-family: 'Cinzel', serif;
            font-size: 1.75rem;
            color: var(--accent-gold);
        }

        .achievements-count {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .achievement-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-card.unlocked {
            border-color: var(--accent-gold);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 215, 0, 0.05));
        }

        .achievement-card.locked {
            opacity: 0.5;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.2);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
            display: block;
            filter: grayscale(100%);
        }

        .achievement-card.unlocked .achievement-icon {
            filter: grayscale(0%);
            animation: achievementPulse 2s ease-in-out infinite;
        }

        @keyframes achievementPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .achievement-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .achievement-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .achievement-rarity {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .rarity-common {
            background: rgba(150, 150, 150, 0.3);
            color: #aaa;
        }

        .rarity-rare {
            background: rgba(0, 150, 255, 0.3);
            color: #00d4ff;
        }

        .rarity-epic {
            background: rgba(150, 0, 255, 0.3);
            color: #c084fc;
        }

        .rarity-legendary {
            background: rgba(255, 215, 0, 0.3);
            color: var(--accent-gold);
        }

        .achievement-progress {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .achievement-progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .achievement-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-gold), #ffd700);
            transition: width 0.5s ease;
        }

        .achievement-progress-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Achievement Unlock Animation */
        .achievement-unlock-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--bg-panel);
            border: 3px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            z-index: 1001;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.5);
            animation: achievementUnlock 0.5s ease forwards;
            max-width: 400px;
        }

        @keyframes achievementUnlock {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-unlock-notification .achievement-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: achievementBounce 0.6s ease;
        }

        @keyframes achievementBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .achievement-unlock-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .achievement-unlock-name {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .achievement-unlock-description {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .badge-showcase {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .badge-showcase-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--accent-primary);
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.75rem;
        }

        .badge-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .badge-item:hover {
            transform: scale(1.05);
            border-color: var(--accent-gold);
        }

        .badge-item.unlocked {
            border-color: var(--accent-gold);
            background: rgba(255, 215, 0, 0.05);
        }

        .badge-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.25rem;
        }

        .badge-item.locked .badge-icon {
            filter: grayscale(100%) opacity(0.3);
        }

        .badge-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Collapsible Section Styles */
        .section-collapsible {
            cursor: pointer;
            user-select: none;
        }

        .section-toggle-icon {
            display: inline-block;
            margin-left: 0.5rem;
            transition: transform 0.3s ease;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .section-toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 5000px;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }

        .collapse-all-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .collapse-all-btn:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
        }

        .section-header-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--bg-panel);
            border: 2px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: levelUpAppear 0.5s ease forwards;
        }

        @keyframes levelUpAppear {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .level-up-notification h2 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .stats-panel {
                position: relative;
                top: 0;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.25rem;
            }

            .calendar-day {
                font-size: 0.75rem;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>Life Quest System</h1>
            <p>Rise through consistency. Track your journey. Level up your life.</p>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continue with Google
            </button>
        </div>
    </div>

    <!-- Setup Screen -->
    <div class="setup-screen" id="setupScreen">
        <div class="setup-box">
            <h2>Welcome, Hunter!</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                Let's set up your profile to begin your journey.
            </p>
            <form id="setupForm" onsubmit="completeSetup(event)">
                <div class="form-group">
                    <label>Current Weight (lbs)</label>
                    <input type="number" id="currentWeight" required step="0.1" min="0" placeholder="Enter current weight">
                </div>
                <div class="form-group">
                    <label>Goal Weight (lbs)</label>
                    <input type="number" id="goalWeight" required step="0.1" min="0" placeholder="Enter goal weight">
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">
                    Begin Your Journey
                </button>
            </form>
        </div>
    </div>

    <!-- Daily Report Modal -->
    <div class="daily-report-modal" id="dailyReportModal">
        <div class="daily-report">
            <h2>Daily Report</h2>
            <p class="report-date" id="reportDate"></p>
            
            <div class="motivation-message" id="motivationMessage"></div>
            
            <div class="report-section">
                <h3>üìä Quest Completion</h3>
                <div class="report-stat">
                    <span class="report-stat-label">Quests Completed</span>
                    <span class="report-stat-value" id="reportCompletedQuests">0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">Completion Rate</span>
                    <span class="report-stat-value" id="reportCompletionRate">0%</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">Total XP Earned</span>
                    <span class="report-stat-value" id="reportTotalXP">0</span>
                </div>
            </div>

            <div class="report-section">
                <h3>üìà Stat Growth</h3>
                <div class="report-stat">
                    <span class="report-stat-label">üí™ Strength</span>
                    <span class="report-stat-value" id="reportStrengthGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">‚ù§Ô∏è Vitality</span>
                    <span class="report-stat-value" id="reportVitalityGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">üß† Intelligence</span>
                    <span class="report-stat-value" id="reportIntelligenceGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">‚òØÔ∏è Balance</span>
                    <span class="report-stat-value" id="reportBalanceGain">+0</span>
                </div>
            </div>

            <div class="report-section">
                <h3>üî• Streak</h3>
                <div class="report-stat">
                    <span class="report-stat-label">Current Streak</span>
                    <span class="report-stat-value" id="reportStreak">0 days</span>
                </div>
            </div>

            <button class="close-report-btn" onclick="closeDailyReport()">Continue</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="container hidden" id="mainApp">
        <div class="header">
            <div class="header-left">
                <h1>Life Quest System</h1>
                <p class="subtitle">Rise Through Consistency</p>
            </div>
            <div class="user-profile" id="userProfile">
                <!-- User info will be inserted here -->
            </div>
        </div>

        <div class="work-schedule-input">
            <div class="section-header-wrapper section-collapsible" onclick="toggleSection('workScheduleContent')">
                <strong style="color: var(--accent-primary);">‚öôÔ∏è Work Schedule</strong>
                <span class="section-toggle-icon" id="workScheduleToggle">‚ñº</span>
            </div>
            <div class="collapsible-content" id="workScheduleContent">
                <div class="input-group" style="margin-top: 1rem;">
                    <div class="input-field">
                        <label>Work Start Time</label>
                        <input type="time" id="workStart" />
                    </div>
                    <div class="input-field">
                        <label>Work End Time</label>
                        <input type="time" id="workEnd" />
                    </div>
                    <button class="btn" onclick="setWorkSchedule()">Set Work Schedule</button>
                    <button class="btn btn-clear" onclick="clearWorkSchedule()">Clear</button>
                </div>
            </div>
        </div>

        <div class="work-schedule-banner" id="workBanner">
            <span class="work-icon">üíº</span>
            <div>
                <strong>Work Mode Active</strong>
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                    Some quests are disabled during work hours
                </p>
            </div>
        </div>

        <!-- Calendar Heatmap -->
        <div class="calendar-section">
            <div class="section-header-wrapper section-collapsible" onclick="toggleSection('calendarContent')" style="margin-bottom: 1.5rem;">
                <h2 class="calendar-header" style="margin: 0;">üî• Your Journey</h2>
                <span class="section-toggle-icon" id="calendarToggle">‚ñº</span>
            </div>
            <div class="collapsible-content" id="calendarContent">
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" onclick="previousMonth()">‚Üê Previous</button>
                    <div class="calendar-month-display" id="calendarMonthDisplay"></div>
                    <button class="calendar-nav-btn" onclick="nextMonth()">Next ‚Üí</button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                    <div class="calendar-day-label">Sun</div>
                    <div class="calendar-day-label">Mon</div>
                    <div class="calendar-day-label">Tue</div>
                    <div class="calendar-day-label">Wed</div>
                    <div class="calendar-day-label">Thu</div>
                    <div class="calendar-day-label">Fri</div>
                    <div class="calendar-day-label">Sat</div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar days will be generated here -->
                </div>
            </div>
        </div>

        <!-- Notification Settings -->
        <div class="notification-settings">
            <div class="section-header-wrapper section-collapsible" onclick="toggleSection('notificationContent')">
                <div>
                    <strong style="color: var(--accent-primary);">üîî Quest Reminders</strong>
                    <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        Get notified about incomplete quests
                    </p>
                </div>
                <span class="section-toggle-icon" id="notificationToggle2">‚ñº</span>
            </div>
            <div class="collapsible-content" id="notificationContent">
                <div class="notification-toggle" style="margin-top: 1rem;">
                    <span>Enable Notifications</span>
                    <div class="toggle-switch" id="notificationToggle" onclick="toggleNotifications()"></div>
                </div>
                <div class="notification-time-select" id="notificationTimeSettings" style="display: none;">
                    <label>Evening Reminder Time</label>
                    <input type="time" id="reminderTime" value="20:00" onchange="updateReminderTime()">
                </div>
            </div>
        </div>

        <!-- Weekly Quests Section -->
        <div class="weekly-quests-section">
            <div class="weekly-header section-collapsible" onclick="toggleSection('weeklyQuestsContent')" style="cursor: pointer;">
                <div class="section-header-wrapper" style="width: 100%;">
                    <h2 class="weekly-title">‚≠ê Weekly Quests</h2>
                    <span class="section-toggle-icon" id="weeklyQuestsToggle">‚ñº</span>
                </div>
                <div class="weekly-reset-timer">
                    <strong id="weeklyResetTime">Resets in X days</strong>
                    <span>Complete for bonus XP & rewards</span>
                </div>
            </div>
            <div class="collapsible-content" id="weeklyQuestsContent">
                <div id="weeklyQuestsContainer" style="margin-top: 1.5rem;">
                    <!-- Weekly quests will be generated here -->
                </div>
                <div class="weekly-progress-bar">
                    <div class="weekly-progress-label">
                        <span>Weekly Progress</span>
                        <span id="weeklyProgressText">0 / 6</span>
                    </div>
                    <div class="weekly-progress-fill">
                        <div class="weekly-progress-fill-inner" id="weeklyProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Panel -->
        <div class="achievements-panel">
            <div class="achievements-header section-collapsible" onclick="toggleSection('achievementsContent')">
                <div class="section-header-wrapper" style="width: 100%;">
                    <h2 class="achievements-title">üèÜ Achievements</h2>
                    <span class="section-toggle-icon" id="achievementsToggle">‚ñº</span>
                </div>
                <span class="achievements-count" id="achievementCount">0 / 0 Unlocked</span>
            </div>
            <div class="collapsible-content" id="achievementsContent">
                <div class="achievements-grid" id="achievementsGrid" style="margin-top: 1.5rem;">
                    <!-- Achievements will be generated here -->
                </div>
                <div class="badge-showcase">
                    <h3 class="badge-showcase-title">üéñÔ∏è Badge Collection</h3>
                    <div class="badge-grid" id="badgeGrid">
                        <!-- Badges will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="stats-panel">
                <div class="player-level">
                    <div class="level-display" id="playerLevel">1</div>
                    <div class="level-label">Hunter Level</div>
                    <div class="xp-bar">
                        <div class="xp-label">
                            <span>XP</span>
                            <span id="xpText">0 / 100</span>
                        </div>
                        <div class="xp-progress">
                            <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>üí™ Strength</span>
                        <span class="stat-value" id="strengthValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="strengthBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>‚ù§Ô∏è Vitality</span>
                        <span class="stat-value" id="vitalityValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="vitalityBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>üß† Intelligence</span>
                        <span class="stat-value" id="intelligenceValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="intelligenceBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>‚òØÔ∏è Balance</span>
                        <span class="stat-value" id="balanceValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="balanceBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Weight Tracker -->
                <div class="weight-tracker">
                    <div class="weight-header">
                        <span class="weight-title">‚öñÔ∏è Weight Progress</span>
                    </div>
                    <div class="weight-stats">
                        <div class="weight-stat">
                            <div class="weight-stat-label">Current</div>
                            <div class="weight-stat-value" id="currentWeightDisplay">--</div>
                        </div>
                        <div class="weight-stat">
                            <div class="weight-stat-label">Goal</div>
                            <div class="weight-stat-value" id="goalWeightDisplay">--</div>
                        </div>
                        <div class="weight-stat">
                            <div class="weight-stat-label">Progress</div>
                            <div class="weight-stat-value" id="weightProgressDisplay">0%</div>
                        </div>
                    </div>
                    <div class="weight-progress">
                        <div class="weight-progress-fill" id="weightProgressBar" style="width: 0%"></div>
                    </div>
                    <div class="weight-input-group">
                        <input type="number" id="weeklyWeightInput" placeholder="Weekly check-in" step="0.1">
                        <button class="btn-small" onclick="updateWeight()">Update</button>
                    </div>
                </div>

                <div class="streak-display">
                    <div class="streak-number" id="streakNumber">0</div>
                    <div class="streak-label">Day Streak üî•</div>
                </div>
            </div>

            <div class="quests-section" id="questsContainer">
                <!-- Quests will be generated here -->
            </div>
        </div>

        <div class="daily-summary">
            <div class="summary-stat">
                <div class="summary-value" id="completedToday">0</div>
                <div class="summary-label">Quests Completed Today</div>
            </div>
            <div class="summary-stat">
                <div class="summary-value" id="totalXpToday">0</div>
                <div class="summary-label">Total XP Earned</div>
            </div>
            <button class="btn" onclick="showDailyReport()" style="margin-top: 1rem;">
                View Today's Report
            </button>
        </div>

        <!-- Collapse All Button -->
        <button class="collapse-all-btn" id="collapseAllBtn" onclick="toggleAllSections()">
            Collapse All ‚ñ≤
        </button>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVzK8Gn-FJSCASD9EOY3X3aDp0VnJYRFo",
            authDomain: "life-quest-system.firebaseapp.com",
            projectId: "life-quest-system",
            storageBucket: "life-quest-system.firebasestorage.app",
            messagingSenderId: "547457902322",
            appId: "1:547457902322:web:51e3790e7cfd29816cd26b",
            measurementId: "G-W3K0TWEQS4"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase initialized successfully');
        } catch (error) {
            console.error('‚ùå Firebase initialization error:', error);
            alert('Firebase initialization failed. Please check your configuration.');
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let gameState = {
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            stats: {
                strength: 0,
                vitality: 0,
                intelligence: 0,
                balance: 0
            },
            streak: 0,
            lastCompletionDate: null,
            completedQuests: [],
            workSchedule: null,
            notificationsEnabled: false,
            notifiedQuests: [],
            weight: {
                current: 0,
                goal: 0,
                history: []
            },
            dailyHistory: {}, // Store completion data for each day
            statsBeforeToday: {
                strength: 0,
                vitality: 0,
                intelligence: 0,
                balance: 0
            },
            calories: {
                target: 2000,
                meals: {}, // breakfast, lunch, dinner calories
                dailyTotal: 0
            },
            notificationSettings: {
                enabled: false,
                reminderTime: "20:00"
            },
            currentCalendarMonth: new Date().getMonth(),
            currentCalendarYear: new Date().getFullYear(),
            weeklyQuests: {
                lastReset: null,
                completed: [],
                currentWeek: []
            },
            achievements: {
                unlocked: [],
                progress: {}
            }
        };

        // Quest definitions
        const questCategories = [
            {
                name: "Morning Routine",
                icon: "üåÖ",
                quests: [
                    { id: "wake-up", name: "Wake up at 8:30 AM", time: "08:30", xp: 10, stats: ["vitality"], workBlocked: false },
                    { id: "morning-hydration", name: "Drink water (500ml)", time: "08:45", xp: 5, stats: ["vitality"], workBlocked: false },
                    { id: "morning-meditation", name: "Morning meditation", time: "09:00", xp: 15, stats: ["balance"], workBlocked: false }
                ]
            },
            {
                name: "Personal Care",
                icon: "üßº",
                quests: [
                    { id: "morning-shower", name: "Morning shower/bath", time: "08:00", xp: 10, stats: ["vitality", "balance"], workBlocked: false },
                    { id: "brush-morning", name: "Brush teeth (morning)", time: "08:15", xp: 5, stats: ["vitality"], workBlocked: false },
                    { id: "brush-night", name: "Brush teeth (night)", time: "23:30", xp: 5, stats: ["vitality"], workBlocked: false },
                    { id: "skincare", name: "Skincare routine", time: "Flexible", xp: 10, stats: ["vitality", "balance"], workBlocked: false },
                    { id: "grooming", name: "Grooming (shave/hair/nails)", time: "Flexible", xp: 10, stats: ["balance"], workBlocked: true }
                ]
            },
            {
                name: "Fitness & Health",
                icon: "üí™",
                quests: [
                    { id: "daily-run", name: "Daily run (any distance)", time: "09:30", xp: 20, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "workout-1", name: "First workout session (30min)", time: "10:00", xp: 25, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "workout-2", name: "Second workout session (30min)", time: "18:00", xp: 25, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "yoga", name: "Yoga practice", time: "20:00", xp: 20, stats: ["balance", "strength"], workBlocked: true }
                ]
            },
            {
                name: "Nutrition",
                icon: "üçΩÔ∏è",
                quests: [
                    { id: "breakfast", name: "Healthy breakfast", time: "09:30", xp: 15, stats: ["vitality"], workBlocked: false, hasCalories: true },
                    { id: "lunch", name: "Nutritious lunch", time: "13:00", xp: 15, stats: ["vitality"], workBlocked: false, hasCalories: true },
                    { id: "dinner", name: "Balanced dinner", time: "19:00", xp: 15, stats: ["vitality"], workBlocked: false, hasCalories: true },
                    { id: "hydration", name: "Daily water intake (2L)", time: "All day", xp: 10, stats: ["vitality"], workBlocked: false }
                ]
            },
            {
                name: "Productivity & Growth",
                icon: "üìö",
                quests: [
                    { id: "focused-work", name: "Focused work session", time: "Work hours", xp: 20, stats: ["intelligence"], workBlocked: false },
                    { id: "learning", name: "Learning/skill development (30min)", time: "17:00", xp: 25, stats: ["intelligence"], workBlocked: true },
                    { id: "creative-hobby", name: "Creative hobby time", time: "20:30", xp: 20, stats: ["intelligence", "balance"], workBlocked: true }
                ]
            },
            {
                name: "Environment",
                icon: "‚ú®",
                quests: [
                    { id: "tidy-space", name: "Tidy workspace/living area", time: "21:00", xp: 15, stats: ["balance"], workBlocked: true },
                    { id: "deep-clean", name: "Deep clean one area", time: "Flexible", xp: 10, stats: ["balance"], workBlocked: true }
                ]
            },
            {
                name: "Evening Routine",
                icon: "üåô",
                quests: [
                    { id: "evening-reflection", name: "Daily reflection/journaling", time: "22:00", xp: 15, stats: ["intelligence", "balance"], workBlocked: false },
                    { id: "screen-off", name: "Screen-free time (1hr before bed)", time: "22:59", xp: 10, stats: ["balance"], workBlocked: false },
                    { id: "sleep", name: "Sleep by 11:59 PM", time: "23:59", xp: 20, stats: ["vitality", "balance"], workBlocked: false }
                ]
            }
        ];

        // Weekly Quest Pool (6 random quests selected each week)
        const weeklyQuestPool = [
            // Adventure
            { id: "wq-beach", name: "Visit the beach or lake", description: "Spend time by the water, relax and recharge", category: "Adventure", xp: 100, icon: "üèñÔ∏è" },
            { id: "wq-new-place", name: "Explore a new place", description: "Visit somewhere you've never been before", category: "Adventure", xp: 100, icon: "üó∫Ô∏è" },
            { id: "wq-new-restaurant", name: "Try a new restaurant", description: "Experience different cuisine or atmosphere", category: "Adventure", xp: 75, icon: "üçú" },
            { id: "wq-outdoor-activity", name: "Do an outdoor activity", description: "Hiking, biking, or any outdoor sport", category: "Adventure", xp: 100, icon: "üö¥" },
            
            // Social
            { id: "wq-meet-friend", name: "Meet up with a friend", description: "Quality time with someone you care about", category: "Social", xp: 75, icon: "üë•" },
            { id: "wq-call-family", name: "Call family or old friend", description: "Reconnect with someone important", category: "Social", xp: 50, icon: "üìû" },
            { id: "wq-make-connection", name: "Make a new connection", description: "Meet someone new or network", category: "Social", xp: 100, icon: "ü§ù" },
            { id: "wq-deep-conversation", name: "Have a meaningful conversation", description: "Go beyond small talk with someone", category: "Social", xp: 75, icon: "üí¨" },
            
            // Experience
            { id: "wq-new-hobby", name: "Try a new hobby", description: "Start learning something you've been curious about", category: "Experience", xp: 100, icon: "üé®" },
            { id: "wq-attend-event", name: "Attend an event", description: "Concert, show, class, or community event", category: "Experience", xp: 75, icon: "üé≠" },
            { id: "wq-create-something", name: "Create something", description: "Art, music, writing, or any creative work", category: "Experience", xp: 100, icon: "‚ú®" },
            { id: "wq-learn-skill", name: "Learn a new skill", description: "Dedicate time to skill development", category: "Experience", xp: 100, icon: "üìö" },
            
            // Nature
            { id: "wq-nature-walk", name: "Nature walk or hike", description: "Spend 1+ hour in nature", category: "Nature", xp: 75, icon: "üå≤" },
            { id: "wq-sunrise-sunset", name: "Watch sunrise or sunset", description: "Witness nature's beauty mindfully", category: "Nature", xp: 50, icon: "üåÖ" },
            { id: "wq-park-visit", name: "Visit a park", description: "Relax and disconnect in green space", category: "Nature", xp: 50, icon: "üå≥" },
            
            // Learning
            { id: "wq-finish-book", name: "Finish a book", description: "Complete a book you've been reading", category: "Learning", xp: 100, icon: "üìñ" },
            { id: "wq-course-module", name: "Complete online course module", description: "Progress in your learning journey", category: "Learning", xp: 100, icon: "üíª" },
            { id: "wq-documentary", name: "Watch an educational documentary", description: "Learn something new through media", category: "Learning", xp: 50, icon: "üé¨" },
            
            // Creativity
            { id: "wq-photo-project", name: "Photo project or photography walk", description: "Capture the world through your lens", category: "Creativity", xp: 75, icon: "üì∏" },
            { id: "wq-write-something", name: "Write creatively", description: "Story, poem, blog post, or journal entry", category: "Creativity", xp: 75, icon: "‚úçÔ∏è" },
            { id: "wq-music-session", name: "Music practice or jam session", description: "Express yourself through music", category: "Creativity", xp: 75, icon: "üéµ" }
        ];

        // Achievement Definitions
        const achievements = [
            // Streak Achievements
            { 
                id: "streak-7", 
                name: "Week Warrior", 
                description: "Maintain a 7-day streak", 
                icon: "üî•", 
                rarity: "common",
                check: (state) => state.streak >= 7,
                progress: (state) => ({ current: state.streak, target: 7 })
            },
            { 
                id: "streak-30", 
                name: "Month Master", 
                description: "Maintain a 30-day streak", 
                icon: "üåü", 
                rarity: "rare",
                check: (state) => state.streak >= 30,
                progress: (state) => ({ current: state.streak, target: 30 })
            },
            { 
                id: "streak-100", 
                name: "Century Hunter", 
                description: "Maintain a 100-day streak", 
                icon: "üíØ", 
                rarity: "epic",
                check: (state) => state.streak >= 100,
                progress: (state) => ({ current: state.streak, target: 100 })
            },
            { 
                id: "streak-365", 
                name: "Eternal Flame", 
                description: "Maintain a 365-day streak", 
                icon: "üëë", 
                rarity: "legendary",
                check: (state) => state.streak >= 365,
                progress: (state) => ({ current: state.streak, target: 365 })
            },
            
            // Level Achievements
            { 
                id: "level-10", 
                name: "Rising Star", 
                description: "Reach level 10", 
                icon: "‚≠ê", 
                rarity: "common",
                check: (state) => state.level >= 10,
                progress: (state) => ({ current: state.level, target: 10 })
            },
            { 
                id: "level-25", 
                name: "Veteran Hunter", 
                description: "Reach level 25", 
                icon: "üéñÔ∏è", 
                rarity: "rare",
                check: (state) => state.level >= 25,
                progress: (state) => ({ current: state.level, target: 25 })
            },
            { 
                id: "level-50", 
                name: "Elite Warrior", 
                description: "Reach level 50", 
                icon: "‚öîÔ∏è", 
                rarity: "epic",
                check: (state) => state.level >= 50,
                progress: (state) => ({ current: state.level, target: 50 })
            },
            { 
                id: "level-100", 
                name: "Legendary Champion", 
                description: "Reach level 100", 
                icon: "üèÜ", 
                rarity: "legendary",
                check: (state) => state.level >= 100,
                progress: (state) => ({ current: state.level, target: 100 })
            },
            
            // Perfect Days
            {
                id: "perfect-10",
                name: "Perfect Ten",
                description: "Complete 10 days with 100% completion",
                icon: "‚ú®",
                rarity: "common",
                check: (state) => countPerfectDays(state) >= 10,
                progress: (state) => ({ current: countPerfectDays(state), target: 10 })
            },
            {
                id: "perfect-50",
                name: "Perfectionist",
                description: "Complete 50 days with 100% completion",
                icon: "üíé",
                rarity: "epic",
                check: (state) => countPerfectDays(state) >= 50,
                progress: (state) => ({ current: countPerfectDays(state), target: 50 })
            },
            
            // Stat Achievements
            {
                id: "stat-strength-50",
                name: "Iron Body",
                description: "Reach 50 Strength",
                icon: "üí™",
                rarity: "common",
                check: (state) => state.stats.strength >= 50,
                progress: (state) => ({ current: state.stats.strength, target: 50 })
            },
            {
                id: "stat-strength-100",
                name: "Titan Force",
                description: "Reach 100 Strength",
                icon: "ü¶æ",
                rarity: "rare",
                check: (state) => state.stats.strength >= 100,
                progress: (state) => ({ current: state.stats.strength, target: 100 })
            },
            {
                id: "stat-vitality-100",
                name: "Undying Vitality",
                description: "Reach 100 Vitality",
                icon: "‚ù§Ô∏è",
                rarity: "rare",
                check: (state) => state.stats.vitality >= 100,
                progress: (state) => ({ current: state.stats.vitality, target: 100 })
            },
            {
                id: "stat-intelligence-100",
                name: "Supreme Mind",
                description: "Reach 100 Intelligence",
                icon: "üß†",
                rarity: "rare",
                check: (state) => state.stats.intelligence >= 100,
                progress: (state) => ({ current: state.stats.intelligence, target: 100 })
            },
            {
                id: "stat-balance-100",
                name: "Zen Master",
                description: "Reach 100 Balance",
                icon: "‚òØÔ∏è",
                rarity: "rare",
                check: (state) => state.stats.balance >= 100,
                progress: (state) => ({ current: state.stats.balance, target: 100 })
            },
            {
                id: "stat-all-50",
                name: "Well Balanced",
                description: "Reach 50 in all stats",
                icon: "‚öñÔ∏è",
                rarity: "epic",
                check: (state) => Object.values(state.stats).every(s => s >= 50),
                progress: (state) => ({ current: Math.min(...Object.values(state.stats)), target: 50 })
            },
            
            // Weekly Quest Achievements
            {
                id: "weekly-10",
                name: "Weekly Warrior",
                description: "Complete 10 weekly quests",
                icon: "‚≠ê",
                rarity: "common",
                check: (state) => countCompletedWeeklyQuests(state) >= 10,
                progress: (state) => ({ current: countCompletedWeeklyQuests(state), target: 10 })
            },
            {
                id: "weekly-25",
                name: "Weekend Champion",
                description: "Complete 25 weekly quests",
                icon: "üåü",
                rarity: "rare",
                check: (state) => countCompletedWeeklyQuests(state) >= 25,
                progress: (state) => ({ current: countCompletedWeeklyQuests(state), target: 25 })
            },
            {
                id: "weekly-50",
                name: "Experience Seeker",
                description: "Complete 50 weekly quests",
                icon: "üéØ",
                rarity: "epic",
                check: (state) => countCompletedWeeklyQuests(state) >= 50,
                progress: (state) => ({ current: countCompletedWeeklyQuests(state), target: 50 })
            },
            
            // Weight Goal
            {
                id: "weight-goal",
                name: "Goal Crusher",
                description: "Reach your target weight",
                icon: "‚öñÔ∏è",
                rarity: "epic",
                check: (state) => {
                    if (state.weight.goal === 0) return false;
                    const diff = Math.abs(state.weight.current - state.weight.goal);
                    return diff <= 2; // Within 2 lbs of goal
                },
                progress: (state) => {
                    const diff = Math.abs(state.weight.current - state.weight.goal);
                    return { current: Math.max(0, 10 - diff), target: 10 };
                }
            },
            
            // Special Achievements
            {
                id: "early-bird",
                name: "Early Bird",
                description: "Complete all morning quests for 30 days",
                icon: "üåÖ",
                rarity: "rare",
                check: (state) => countMorningStreaks(state) >= 30,
                progress: (state) => ({ current: countMorningStreaks(state), target: 30 })
            },
            {
                id: "night-owl-good",
                name: "Night Owl Master",
                description: "Perfect evening routine for 30 days",
                icon: "üåô",
                rarity: "rare",
                check: (state) => countEveningStreaks(state) >= 30,
                progress: (state) => ({ current: countEveningStreaks(state), target: 30 })
            },
            {
                id: "fitness-fanatic",
                name: "Fitness Fanatic",
                description: "Complete all workouts for a month",
                icon: "üèãÔ∏è",
                rarity: "epic",
                check: (state) => countFitnessStreaks(state) >= 30,
                progress: (state) => ({ current: countFitnessStreaks(state), target: 30 })
            }
        ];

        // Helper functions for achievement checks
        function countPerfectDays(state) {
            return Object.values(state.dailyHistory).filter(day => {
                const rate = (day.completed.length / day.total) * 100;
                return rate === 100;
            }).length;
        }

        function countCompletedWeeklyQuests(state) {
            // Count all weekly quests ever completed (stored in achievements.progress)
            return state.achievements.progress.totalWeeklyCompleted || 0;
        }

        function countMorningStreaks(state) {
            // This would need more sophisticated tracking - placeholder for now
            return state.achievements.progress.morningStreak || 0;
        }

        function countEveningStreaks(state) {
            return state.achievements.progress.eveningStreak || 0;
        }

        function countFitnessStreaks(state) {
            return state.achievements.progress.fitnessStreak || 0;
        }

        // Auth state observer
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                loadUserData();
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        // Google Sign In
        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                console.log('Attempting to sign in with Google...');
                await auth.signInWithPopup(provider);
                console.log('Sign in successful!');
            } catch (error) {
                console.error('Error signing in:', error);
                console.error('Error code:', error.code);
                console.error('Error message:', error.message);
                
                let errorMessage = 'Error signing in. ';
                
                if (error.code === 'auth/unauthorized-domain') {
                    errorMessage += 'Your domain is not authorized. Go to Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains and add your domain.';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage += 'Pop-up was blocked by your browser. Please allow pop-ups for this site.';
                } else if (error.code === 'auth/cancelled-popup-request') {
                    errorMessage += 'Sign-in was cancelled. Please try again.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
            }
        }

        // Sign Out
        async function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                await auth.signOut();
                location.reload();
            }
        }

        // Load user data from Firestore
        async function loadUserData() {
            const docRef = db.collection('users').doc(currentUser.uid);
            const doc = await docRef.get();

            if (doc.exists) {
                const data = doc.data();
                gameState = { ...gameState, ...data };
                
                // Check if it's a new day
                const today = new Date().toDateString();
                if (gameState.lastCompletionDate !== today) {
                    // Save yesterday's stats before resetting
                    gameState.statsBeforeToday = { ...gameState.stats };
                    
                    // Reset daily quests
                    gameState.completedQuests = [];
                    
                    // Check streak
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    if (gameState.lastCompletionDate !== yesterday.toDateString()) {
                        gameState.streak = 0;
                    }
                    
                    await saveUserData();
                }
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                renderUserProfile();
                initializeWeeklyQuests();
                updateUI();
                renderCalendar();
                renderWeeklyQuests();
                renderAchievements();
                loadCollapsedState();
            } else {
                // New user - show setup
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('setupScreen').style.display = 'flex';
            }
        }

        // Complete setup
        async function completeSetup(event) {
            event.preventDefault();
            const currentWeight = parseFloat(document.getElementById('currentWeight').value);
            const goalWeight = parseFloat(document.getElementById('goalWeight').value);
            
            gameState.weight.current = currentWeight;
            gameState.weight.goal = goalWeight;
            gameState.weight.history = [{
                date: new Date().toISOString(),
                weight: currentWeight
            }];
            
            await saveUserData();
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
            renderUserProfile();
            initializeWeeklyQuests();
            updateUI();
            renderCalendar();
            renderWeeklyQuests();
            renderAchievements();
            loadCollapsedState();
        }

        // Save user data to Firestore
        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).set(gameState);
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Render user profile
        function renderUserProfile() {
            const profile = document.getElementById('userProfile');
            profile.innerHTML = `
                <img src="${currentUser.photoURL}" alt="Profile" class="user-avatar">
                <div class="user-info">
                    <div class="user-name">${currentUser.displayName}</div>
                    <div class="user-email">${currentUser.email}</div>
                </div>
                <button class="logout-btn" onclick="signOut()">Sign Out</button>
            `;
        }

        // Set work schedule
        function setWorkSchedule() {
            const start = document.getElementById('workStart').value;
            const end = document.getElementById('workEnd').value;
            
            if (start && end) {
                gameState.workSchedule = { start, end };
                saveUserData();
                updateUI();
                checkWorkMode();
            }
        }

        function clearWorkSchedule() {
            gameState.workSchedule = null;
            document.getElementById('workStart').value = '';
            document.getElementById('workEnd').value = '';
            saveUserData();
            updateUI();
        }

        // Check if currently in work mode
        function checkWorkMode() {
            if (!gameState.workSchedule) {
                document.getElementById('workBanner').classList.remove('active');
                return false;
            }

            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const [startHour, startMin] = gameState.workSchedule.start.split(':').map(Number);
            const [endHour, endMin] = gameState.workSchedule.end.split(':').map(Number);
            
            const startTime = startHour * 60 + startMin;
            const endTime = endHour * 60 + endMin;
            
            const isWorkTime = currentTime >= startTime && currentTime <= endTime;
            
            if (isWorkTime) {
                document.getElementById('workBanner').classList.add('active');
            } else {
                document.getElementById('workBanner').classList.remove('active');
            }
            
            return isWorkTime;
        }

        // Complete quest
        function completeQuest(questId, quest) {
            if (gameState.completedQuests.includes(questId)) {
                return; // Already completed
            }
            
            gameState.completedQuests.push(questId);
            gameState.xp += quest.xp;
            
            // Add stats
            quest.stats.forEach(stat => {
                gameState.stats[stat] += 2;
            });
            
            // Update completion date and streak
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (gameState.lastCompletionDate === yesterday.toDateString()) {
                gameState.streak += 1;
            } else if (gameState.lastCompletionDate !== today) {
                gameState.streak = 1;
            }
            
            gameState.lastCompletionDate = today;
            
            // Store daily completion data
            if (!gameState.dailyHistory[today]) {
                gameState.dailyHistory[today] = {
                    completed: [],
                    total: questCategories.reduce((sum, cat) => sum + cat.quests.length, 0)
                };
            }
            gameState.dailyHistory[today].completed = [...gameState.completedQuests];
            
            // Check level up
            while (gameState.xp >= gameState.xpToNextLevel) {
                levelUp();
            }
            
            saveUserData();
            updateUI();
            renderCalendar();
            
            // Check for achievement unlocks
            checkAchievements();
        }

        // Level up
        function levelUp() {
            gameState.xp -= gameState.xpToNextLevel;
            gameState.level += 1;
            gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
            
            // Boost all stats
            Object.keys(gameState.stats).forEach(stat => {
                gameState.stats[stat] += 5;
            });
            
            showLevelUpNotification();
        }

        function showLevelUpNotification() {
            const notification = document.createElement('div');
            notification.className = 'level-up-notification';
            notification.innerHTML = `
                <h2>LEVEL UP!</h2>
                <p style="font-size: 1.5rem; color: var(--text-secondary);">You've reached Level ${gameState.level}</p>
                <p style="margin-top: 1rem; color: var(--accent-primary);">All stats increased!</p>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Update weight
        function updateWeight() {
            const newWeight = parseFloat(document.getElementById('weeklyWeightInput').value);
            if (!newWeight || newWeight <= 0) return;
            
            gameState.weight.current = newWeight;
            gameState.weight.history.push({
                date: new Date().toISOString(),
                weight: newWeight
            });
            
            document.getElementById('weeklyWeightInput').value = '';
            saveUserData();
            updateUI();
        }

        // Render calendar heatmap
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const today = new Date();
            
            for (let i = 27; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                const dayNumber = date.getDate();
                
                let percentage = 0;
                let className = '';
                
                if (gameState.dailyHistory[dateStr]) {
                    const completed = gameState.dailyHistory[dateStr].completed.length;
                    const total = gameState.dailyHistory[dateStr].total;
                    percentage = Math.round((completed / total) * 100);
                    
                    if (percentage >= 80) {
                        className = 'perfect';
                    } else if (percentage >= 60) {
                        className = 'high';
                    } else if (percentage >= 40) {
                        className = 'medium';
                    } else if (percentage > 0) {
                        className = 'low';
                    }
                }
                
                dayDiv.className = `calendar-day ${className}`;
                dayDiv.innerHTML = `
                    <div class="calendar-day-number">${dayNumber}</div>
                    ${percentage > 0 ? `<div class="calendar-day-percentage">${percentage}%</div>` : ''}
                `;
                
                dayDiv.title = `${dateStr}: ${percentage}% complete`;
                
                grid.appendChild(dayDiv);
            }
        }

        // Show daily report
        function showDailyReport() {
            const today = new Date().toDateString();
            const totalQuests = questCategories.reduce((sum, cat) => sum + cat.quests.length, 0);
            const completedQuests = gameState.completedQuests.length;
            const completionRate = Math.round((completedQuests / totalQuests) * 100);
            
            const totalXp = gameState.completedQuests.reduce((sum, id) => {
                const quest = questCategories.flatMap(c => c.quests).find(q => q.id === id);
                return sum + (quest ? quest.xp : 0);
            }, 0);
            
            // Calculate stat gains
            const strengthGain = gameState.stats.strength - gameState.statsBeforeToday.strength;
            const vitalityGain = gameState.stats.vitality - gameState.statsBeforeToday.vitality;
            const intelligenceGain = gameState.stats.intelligence - gameState.statsBeforeToday.intelligence;
            const balanceGain = gameState.stats.balance - gameState.statsBeforeToday.balance;
            
            // Motivational messages
            const messages = [
                "Incredible work today, Hunter! Your consistency is your greatest strength.",
                "Every quest completed brings you closer to your goals. Keep pushing!",
                "You're building something amazing, one day at a time.",
                "The path to greatness is walked daily. You're on it!",
                "Your dedication today shapes your success tomorrow.",
                "Small steps lead to big transformations. You're proving it!",
                "Excellence is a habit, and you're cultivating it beautifully.",
                "Your future self will thank you for today's efforts."
            ];
            
            const motivation = messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('motivationMessage').textContent = motivation;
            document.getElementById('reportCompletedQuests').textContent = `${completedQuests} / ${totalQuests}`;
            document.getElementById('reportCompletionRate').textContent = `${completionRate}%`;
            document.getElementById('reportTotalXP').textContent = totalXp;
            
            document.getElementById('reportStrengthGain').textContent = `+${strengthGain}`;
            document.getElementById('reportVitalityGain').textContent = `+${vitalityGain}`;
            document.getElementById('reportIntelligenceGain').textContent = `+${intelligenceGain}`;
            document.getElementById('reportBalanceGain').textContent = `+${balanceGain}`;
            
            document.getElementById('reportStreak').textContent = `${gameState.streak} days`;
            
            document.getElementById('dailyReportModal').classList.add('active');
        }

        function closeDailyReport() {
            document.getElementById('dailyReportModal').classList.remove('active');
        }

        // Calorie Tracking Functions
        function updateCalories(mealId, calories) {
            const today = new Date().toDateString();
            if (!gameState.calories.meals[today]) {
                gameState.calories.meals[today] = {};
            }
            gameState.calories.meals[today][mealId] = parseFloat(calories) || 0;
            
            // Calculate daily total
            const todayMeals = gameState.calories.meals[today];
            gameState.calories.dailyTotal = Object.values(todayMeals).reduce((sum, cal) => sum + cal, 0);
            
            saveUserData();
            renderQuests();
        }

        function getTodayCalories() {
            const today = new Date().toDateString();
            return gameState.calories.meals[today] || {};
        }

        // Notification Functions
        async function toggleNotifications() {
            const toggle = document.getElementById('notificationToggle');
            const settings = document.getElementById('notificationTimeSettings');
            
            if (!gameState.notificationSettings.enabled) {
                // Request permission
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        gameState.notificationSettings.enabled = true;
                        toggle.classList.add('active');
                        settings.style.display = 'block';
                        
                        // Show test notification
                        new Notification('Quest Reminders Enabled!', {
                            body: 'You\'ll receive reminders for incomplete quests.',
                            icon: 'PP.png'
                        });
                    } else {
                        alert('Please enable notifications in your browser settings.');
                    }
                }
            } else {
                // Disable notifications
                gameState.notificationSettings.enabled = false;
                toggle.classList.remove('active');
                settings.style.display = 'none';
            }
            
            saveUserData();
        }

        function updateReminderTime() {
            const time = document.getElementById('reminderTime').value;
            gameState.notificationSettings.reminderTime = time;
            saveUserData();
        }

        function checkAndSendReminders() {
            if (!gameState.notificationSettings.enabled || Notification.permission !== 'granted') {
                return;
            }

            const now = new Date();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            // Check if it's reminder time
            if (currentTime === gameState.notificationSettings.reminderTime) {
                const totalQuests = questCategories.reduce((sum, cat) => sum + cat.quests.length, 0);
                const remaining = totalQuests - gameState.completedQuests.length;
                
                if (remaining > 0) {
                    new Notification(`Quest Reminder`, {
                        body: `You have ${remaining} quest${remaining > 1 ? 's' : ''} remaining today. Keep up the momentum!`,
                        icon: 'PP.png',
                        tag: 'daily-reminder'
                    });
                }
            }
        }

        // Calendar Navigation Functions
        function previousMonth() {
            if (gameState.currentCalendarMonth === 0) {
                gameState.currentCalendarMonth = 11;
                gameState.currentCalendarYear--;
            } else {
                gameState.currentCalendarMonth--;
            }
            renderCalendar();
            saveUserData();
        }

        function nextMonth() {
            // Don't allow going beyond current month
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            if (gameState.currentCalendarYear < currentYear || 
                (gameState.currentCalendarYear === currentYear && gameState.currentCalendarMonth < currentMonth)) {
                if (gameState.currentCalendarMonth === 11) {
                    gameState.currentCalendarMonth = 0;
                    gameState.currentCalendarYear++;
                } else {
                    gameState.currentCalendarMonth++;
                }
                renderCalendar();
                saveUserData();
            }
        }

        // Render calendar heatmap
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthDisplay = document.getElementById('calendarMonthDisplay');
            grid.innerHTML = '';
            
            const displayDate = new Date(gameState.currentCalendarYear, gameState.currentCalendarMonth, 1);
            const monthName = displayDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            monthDisplay.textContent = monthName;
            
            const today = new Date();
            const firstDay = new Date(gameState.currentCalendarYear, gameState.currentCalendarMonth, 1);
            const lastDay = new Date(gameState.currentCalendarYear, gameState.currentCalendarMonth + 1, 0);
            const firstDayOfWeek = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.style.opacity = '0';
                grid.appendChild(emptyDiv);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(gameState.currentCalendarYear, gameState.currentCalendarMonth, day);
                const dateStr = date.toDateString();
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                let percentage = 0;
                let className = '';
                
                if (gameState.dailyHistory[dateStr]) {
                    const completed = gameState.dailyHistory[dateStr].completed.length;
                    const total = gameState.dailyHistory[dateStr].total;
                    percentage = Math.round((completed / total) * 100);
                    
                    if (percentage >= 80) {
                        className = 'perfect';
                    } else if (percentage >= 60) {
                        className = 'high';
                    } else if (percentage >= 40) {
                        className = 'medium';
                    } else if (percentage > 0) {
                        className = 'low';
                    }
                }
                
                // Check if it's today
                if (date.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }
                
                dayDiv.className = `calendar-day ${className}`;
                if (date.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }
                
                dayDiv.innerHTML = `
                    <div class="calendar-day-number">${day}</div>
                    ${percentage > 0 ? `<div class="calendar-day-percentage">${percentage}%</div>` : ''}
                `;
                
                dayDiv.title = `${dateStr}: ${percentage}% complete`;
                
                grid.appendChild(dayDiv);
            }
        }

        // Weekly Quest Management
        function initializeWeeklyQuests() {
            const now = new Date();
            const weekStart = getWeekStart(now);
            
            // Check if we need to reset (new week)
            if (!gameState.weeklyQuests.lastReset || 
                new Date(gameState.weeklyQuests.lastReset) < weekStart) {
                // Reset weekly quests
                gameState.weeklyQuests.lastReset = weekStart.toISOString();
                gameState.weeklyQuests.completed = [];
                
                // Select 6 random quests from pool
                const shuffled = [...weeklyQuestPool].sort(() => Math.random() - 0.5);
                gameState.weeklyQuests.currentWeek = shuffled.slice(0, 6).map(q => q.id);
                
                saveUserData();
            }
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day; // Adjust to Sunday
            return new Date(d.setDate(diff));
        }

        function getDaysUntilWeekReset() {
            const now = new Date();
            const nextSunday = new Date(now);
            nextSunday.setDate(now.getDate() + (7 - now.getDay()));
            nextSunday.setHours(0, 0, 0, 0);
            
            const diff = nextSunday - now;
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            return days;
        }

        function completeWeeklyQuest(questId) {
            if (gameState.weeklyQuests.completed.includes(questId)) {
                return; // Already completed
            }
            
            const quest = weeklyQuestPool.find(q => q.id === questId);
            if (!quest) return;
            
            // Mark as completed
            gameState.weeklyQuests.completed.push(questId);
            
            // Award XP
            gameState.xp += quest.xp;
            
            // Track total weekly quests completed
            if (!gameState.achievements.progress.totalWeeklyCompleted) {
                gameState.achievements.progress.totalWeeklyCompleted = 0;
            }
            gameState.achievements.progress.totalWeeklyCompleted++;
            
            // Check level up
            while (gameState.xp >= gameState.xpToNextLevel) {
                levelUp();
            }
            
            // Check achievements
            checkAchievements();
            
            saveUserData();
            updateUI();
            renderWeeklyQuests();
        }

        function renderWeeklyQuests() {
            const container = document.getElementById('weeklyQuestsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            const currentQuests = gameState.weeklyQuests.currentWeek || [];
            
            currentQuests.forEach(questId => {
                const quest = weeklyQuestPool.find(q => q.id === questId);
                if (!quest) return;
                
                const isCompleted = gameState.weeklyQuests.completed.includes(questId);
                
                const questDiv = document.createElement('div');
                questDiv.className = `weekly-quest-item ${isCompleted ? 'completed' : ''}`;
                questDiv.innerHTML = `
                    <div class="weekly-quest-header">
                        <div class="weekly-quest-title">${quest.icon} ${quest.name}</div>
                        <div class="weekly-quest-xp">+${quest.xp} XP</div>
                    </div>
                    <div class="weekly-quest-description">${quest.description}</div>
                    <span class="weekly-quest-category">${quest.category}</span>
                `;
                
                if (!isCompleted) {
                    questDiv.onclick = () => {
                        if (confirm(`Complete "${quest.name}"?`)) {
                            completeWeeklyQuest(questId);
                        }
                    };
                }
                
                container.appendChild(questDiv);
            });
            
            // Update progress
            const completed = gameState.weeklyQuests.completed.length;
            const total = currentQuests.length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            
            document.getElementById('weeklyProgressText').textContent = `${completed} / ${total}`;
            document.getElementById('weeklyProgressBar').style.width = `${percentage}%`;
            
            // Update reset timer
            const daysLeft = getDaysUntilWeekReset();
            document.getElementById('weeklyResetTime').textContent = 
                `Resets in ${daysLeft} day${daysLeft !== 1 ? 's' : ''}`;
        }

        // Achievement System
        function checkAchievements() {
            let newUnlocks = [];
            
            achievements.forEach(achievement => {
                // Skip if already unlocked
                if (gameState.achievements.unlocked.includes(achievement.id)) {
                    return;
                }
                
                // Check if achievement criteria is met
                if (achievement.check(gameState)) {
                    gameState.achievements.unlocked.push(achievement.id);
                    newUnlocks.push(achievement);
                }
            });
            
            // Show unlock notifications
            newUnlocks.forEach((achievement, index) => {
                setTimeout(() => {
                    showAchievementUnlock(achievement);
                }, index * 2000); // Stagger notifications
            });
            
            if (newUnlocks.length > 0) {
                saveUserData();
                renderAchievements();
            }
        }

        function showAchievementUnlock(achievement) {
            const notification = document.createElement('div');
            notification.className = 'achievement-unlock-notification';
            notification.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-unlock-title">ACHIEVEMENT UNLOCKED!</div>
                <div class="achievement-unlock-name">${achievement.name}</div>
                <div class="achievement-unlock-description">${achievement.description}</div>
                <button class="btn" onclick="this.parentElement.remove()">Awesome!</button>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            const badgeGrid = document.getElementById('badgeGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            badgeGrid.innerHTML = '';
            
            const unlockedCount = gameState.achievements.unlocked.length;
            const totalCount = achievements.length;
            
            document.getElementById('achievementCount').textContent = 
                `${unlockedCount} / ${totalCount} Unlocked`;
            
            achievements.forEach(achievement => {
                const isUnlocked = gameState.achievements.unlocked.includes(achievement.id);
                const progress = achievement.progress(gameState);
                const progressPercent = Math.min((progress.current / progress.target) * 100, 100);
                
                // Main achievement card
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                card.innerHTML = `
                    <span class="achievement-rarity rarity-${achievement.rarity}">${achievement.rarity}</span>
                    <span class="achievement-icon">${achievement.icon}</span>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-description">${achievement.description}</div>
                    ${!isUnlocked ? `
                        <div class="achievement-progress">
                            <div class="achievement-progress-text">${progress.current} / ${progress.target}</div>
                            <div class="achievement-progress-bar">
                                <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                        </div>
                    ` : ''}
                `;
                grid.appendChild(card);
                
                // Badge version (compact)
                const badge = document.createElement('div');
                badge.className = `badge-item ${isUnlocked ? 'unlocked' : 'locked'}`;
                badge.innerHTML = `
                    <span class="badge-icon">${achievement.icon}</span>
                    <div class="badge-name">${achievement.name}</div>
                `;
                badge.title = achievement.description;
                badgeGrid.appendChild(badge);
            });
        }

        // Section Collapse/Expand Functions
        function toggleSection(contentId) {
            const content = document.getElementById(contentId);
            const toggleIcon = document.getElementById(contentId.replace('Content', 'Toggle'));
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                if (toggleIcon) toggleIcon.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                if (toggleIcon) toggleIcon.classList.add('collapsed');
            }
            
            // Save state
            saveCollapsedState();
        }

        function toggleAllSections() {
            const sections = [
                'workScheduleContent',
                'calendarContent', 
                'notificationContent',
                'weeklyQuestsContent',
                'achievementsContent'
            ];
            
            const btn = document.getElementById('collapseAllBtn');
            const allCollapsed = sections.every(id => 
                document.getElementById(id)?.classList.contains('collapsed')
            );
            
            sections.forEach(id => {
                const content = document.getElementById(id);
                const toggleIcon = document.getElementById(id.replace('Content', 'Toggle'));
                
                if (content) {
                    if (allCollapsed) {
                        content.classList.remove('collapsed');
                        if (toggleIcon) toggleIcon.classList.remove('collapsed');
                    } else {
                        content.classList.add('collapsed');
                        if (toggleIcon) toggleIcon.classList.add('collapsed');
                    }
                }
            });
            
            btn.textContent = allCollapsed ? 'Collapse All ‚ñ≤' : 'Expand All ‚ñº';
            saveCollapsedState();
        }

        function saveCollapsedState() {
            const sections = [
                'workScheduleContent',
                'calendarContent',
                'notificationContent',
                'weeklyQuestsContent',
                'achievementsContent'
            ];
            
            const state = {};
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    state[id] = element.classList.contains('collapsed');
                }
            });
            
            localStorage.setItem('collapsedSections', JSON.stringify(state));
        }

        function loadCollapsedState() {
            const savedState = localStorage.getItem('collapsedSections');
            if (!savedState) return;
            
            try {
                const state = JSON.parse(savedState);
                Object.keys(state).forEach(id => {
                    const content = document.getElementById(id);
                    const toggleIcon = document.getElementById(id.replace('Content', 'Toggle'));
                    
                    if (content && state[id]) {
                        content.classList.add('collapsed');
                        if (toggleIcon) toggleIcon.classList.add('collapsed');
                    }
                });
                
                // Update collapse all button text
                updateCollapseAllButton();
            } catch (e) {
                console.error('Error loading collapsed state:', e);
            }
        }

        function updateCollapseAllButton() {
            const sections = [
                'workScheduleContent',
                'calendarContent',
                'notificationContent',
                'weeklyQuestsContent',
                'achievementsContent'
            ];
            
            const allCollapsed = sections.every(id => 
                document.getElementById(id)?.classList.contains('collapsed')
            );
            
            const btn = document.getElementById('collapseAllBtn');
            if (btn) {
                btn.textContent = allCollapsed ? 'Expand All ‚ñº' : 'Collapse All ‚ñ≤';
            }
        }

        // Render quests
        function renderQuests() {
            const container = document.getElementById('questsContainer');
            container.innerHTML = '';
            
            const isWorkTime = checkWorkMode();
            const todayCalories = getTodayCalories();
            
            questCategories.forEach(category => {
                const completed = category.quests.filter(q => 
                    gameState.completedQuests.includes(q.id)
                ).length;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'quest-category';
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <span class="category-icon">${category.icon}</span>
                        <h2 class="category-title">${category.name}</h2>
                        <span class="category-progress">${completed}/${category.quests.length}</span>
                    </div>
                `;
                
                category.quests.forEach(quest => {
                    const isCompleted = gameState.completedQuests.includes(quest.id);
                    const isBlocked = isWorkTime && quest.workBlocked;
                    
                    const questDiv = document.createElement('div');
                    questDiv.className = `quest-item ${isCompleted ? 'completed' : ''} ${isBlocked ? 'disabled-quest' : ''}`;
                    
                    let calorieTracker = '';
                    if (quest.hasCalories) {
                        const currentCalories = todayCalories[quest.id] || 0;
                        calorieTracker = `
                            <div class="calorie-tracker">
                                <div class="calorie-input-group">
                                    <input type="number" 
                                           class="calorie-input" 
                                           placeholder="Calories" 
                                           value="${currentCalories > 0 ? currentCalories : ''}"
                                           onchange="updateCalories('${quest.id}', this.value)"
                                           onclick="event.stopPropagation()">
                                    <span style="font-size: 0.875rem; color: var(--text-secondary);">cal</span>
                                </div>
                            </div>
                        `;
                    }
                    
                    questDiv.innerHTML = `
                        <div class="quest-checkbox"></div>
                        <div class="quest-content">
                            <div class="quest-name">${quest.name}</div>
                            <div class="quest-time">${quest.time}${isBlocked ? ' - Blocked during work' : ''}</div>
                            ${calorieTracker}
                        </div>
                        <div class="quest-xp">+${quest.xp} XP</div>
                    `;
                    
                    if (!isBlocked) {
                        const checkbox = questDiv.querySelector('.quest-checkbox');
                        const questNameDiv = questDiv.querySelector('.quest-name');
                        const questTimeDiv = questDiv.querySelector('.quest-time');
                        
                        if (checkbox) checkbox.onclick = () => completeQuest(quest.id, quest);
                        if (questNameDiv) questNameDiv.onclick = () => completeQuest(quest.id, quest);
                        if (questTimeDiv) questTimeDiv.onclick = () => completeQuest(quest.id, quest);
                    }
                    
                    categoryDiv.appendChild(questDiv);
                });
                
                // Add daily calorie summary for Nutrition category
                if (category.name === "Nutrition") {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.style.cssText = 'margin-top: 1rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border);';
                    summaryDiv.innerHTML = `
                        <div class="calorie-display">
                            <span style="font-weight: 600;">Daily Total:</span>
                            <span class="calorie-total">${gameState.calories.dailyTotal} / ${gameState.calories.target} cal</span>
                        </div>
                        <div style="height: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 4px; margin-top: 0.5rem; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); width: ${Math.min((gameState.calories.dailyTotal / gameState.calories.target) * 100, 100)}%;"></div>
                        </div>
                    `;
                    categoryDiv.appendChild(summaryDiv);
                }
                
                container.appendChild(categoryDiv);
            });
        }

        // Update UI
        function updateUI() {
            // Level and XP
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('xpText').textContent = `${gameState.xp} / ${gameState.xpToNextLevel}`;
            const xpPercent = (gameState.xp / gameState.xpToNextLevel) * 100;
            document.getElementById('xpFill').style.width = `${xpPercent}%`;
            
            // Stats
            ['strength', 'vitality', 'intelligence', 'balance'].forEach(stat => {
                const value = gameState.stats[stat];
                document.getElementById(`${stat}Value`).textContent = value;
                document.getElementById(`${stat}Bar`).style.width = `${Math.min(value, 100)}%`;
            });
            
            // Weight tracker
            document.getElementById('currentWeightDisplay').textContent = gameState.weight.current.toFixed(1);
            document.getElementById('goalWeightDisplay').textContent = gameState.weight.goal.toFixed(1);
            
            const startWeight = gameState.weight.history[0]?.weight || gameState.weight.current;
            const totalChange = Math.abs(gameState.weight.goal - startWeight);
            const currentChange = Math.abs(gameState.weight.current - startWeight);
            const weightProgress = totalChange > 0 ? Math.round((currentChange / totalChange) * 100) : 0;
            
            document.getElementById('weightProgressDisplay').textContent = `${weightProgress}%`;
            document.getElementById('weightProgressBar').style.width = `${weightProgress}%`;
            
            // Streak
            document.getElementById('streakNumber').textContent = gameState.streak;
            
            // Daily summary
            document.getElementById('completedToday').textContent = gameState.completedQuests.length;
            const totalXp = gameState.completedQuests.reduce((sum, id) => {
                const quest = questCategories.flatMap(c => c.quests).find(q => q.id === id);
                return sum + (quest ? quest.xp : 0);
            }, 0);
            document.getElementById('totalXpToday').textContent = totalXp;
            
            // Work schedule inputs
            if (gameState.workSchedule) {
                document.getElementById('workStart').value = gameState.workSchedule.start;
                document.getElementById('workEnd').value = gameState.workSchedule.end;
            }
            
            // Notification toggle
            const notificationToggle = document.getElementById('notificationToggle');
            const notificationSettings = document.getElementById('notificationTimeSettings');
            if (gameState.notificationSettings.enabled) {
                notificationToggle.classList.add('active');
                notificationSettings.style.display = 'block';
            } else {
                notificationToggle.classList.remove('active');
                notificationSettings.style.display = 'none';
            }
            document.getElementById('reminderTime').value = gameState.notificationSettings.reminderTime;
            
            renderQuests();
        }

        // Check work mode every minute
        setInterval(checkWorkMode, 60000);
        
        // Check for reminders every minute
        setInterval(checkAndSendReminders, 60000);
    </script>
</body>
</html>