<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Quest System</title>
    
    <!-- Custom Favicon - Replace 'PP.png' with the actual path to your uploaded image -->
    <link rel="icon" type="image/png" href="PP.png">
    <link rel="apple-touch-icon" href="PP.png">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a0e17">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Life Quest">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Exo+2:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e17;
            --bg-panel: #131820;
            --bg-card: #1a1f2e;
            --accent-primary: #00d4ff;
            --accent-secondary: #7c3aed;
            --accent-gold: #ffd700;
            --text-primary: #e8eef5;
            --text-secondary: #9ca3af;
            --success: #10b981;
            --danger: #ef4444;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(124, 58, 237, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .login-box h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .login-box p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .google-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            background: white;
            color: #333;
            padding: 1rem 2rem;
            border-radius: 8px;
            border: none;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.2);
        }

        .google-icon {
            width: 20px;
            height: 20px;
        }

        /* Setup Screen */
        .setup-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 23, 0.95);
            z-index: 999;
            overflow-y: auto;
            padding: 2rem;
        }

        .setup-box {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            margin: 2rem auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .setup-box h2 {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--accent-primary);
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .header-left {
            flex: 1;
        }

        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.3)); }
            50% { filter: drop-shadow(0 0 30px rgba(124, 58, 237, 0.5)); }
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--bg-panel);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 2px solid var(--accent-primary);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .user-email {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Exo 2', sans-serif;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .stats-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 2rem;
            height: fit-content;
        }

        .player-level {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }

        .level-display {
            font-family: 'Cinzel', serif;
            font-size: 4rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .level-label {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .xp-bar {
            margin-top: 1.5rem;
        }

        .xp-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .xp-progress {
            height: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 6px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .stat-item {
            margin-bottom: 1.5rem;
        }

        .stat-name {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .stat-value {
            color: var(--accent-primary);
            font-weight: 600;
        }

        .stat-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .weight-tracker {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .weight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .weight-title {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .weight-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .weight-stat {
            flex: 1;
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
        }

        .weight-stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .weight-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .weight-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .weight-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent-primary));
            transition: width 0.5s ease;
        }

        .weight-input-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .weight-input-group input {
            flex: 1;
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 6px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }

        .quests-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .work-schedule-banner {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.2), rgba(0, 212, 255, 0.2));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 1.5rem;
            display: none;
            align-items: center;
            gap: 1rem;
        }

        .work-schedule-banner.active {
            display: flex;
        }

        .work-icon {
            font-size: 2rem;
        }

        .work-schedule-input {
            margin-bottom: 1.5rem;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .input-group {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .input-field {
            flex: 1;
            min-width: 150px;
        }

        .input-field label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-field input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Exo 2', sans-serif;
            font-size: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-clear {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
        }

        .btn-clear:hover {
            background: var(--danger);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
        }

        .quest-category {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .category-icon {
            font-size: 1.5rem;
        }

        .category-title {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            font-weight: 600;
            flex: 1;
        }

        .category-progress {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .quest-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .quest-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .quest-item.completed {
            opacity: 0.6;
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
        }

        .quest-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .quest-item.completed .quest-checkbox {
            background: var(--success);
            border-color: var(--success);
        }

        .quest-checkbox::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quest-item.completed .quest-checkbox::after {
            opacity: 1;
        }

        .quest-content {
            flex: 1;
        }

        .quest-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .quest-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .quest-xp {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--accent-primary);
            border-radius: 6px;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--accent-primary);
        }

        .streak-display {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .streak-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        .streak-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }

        /* Calendar Heatmap */
        .calendar-section {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .calendar-header {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent-primary);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .calendar-day:hover {
            transform: scale(1.05);
            border-color: var(--accent-primary);
        }

        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .calendar-day-percentage {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .calendar-day.perfect {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            border-color: var(--danger);
            color: white;
        }

        .calendar-day.high {
            background: rgba(255, 107, 107, 0.6);
            border-color: rgba(239, 68, 68, 0.8);
        }

        .calendar-day.medium {
            background: rgba(255, 215, 0, 0.3);
            border-color: rgba(255, 215, 0, 0.6);
        }

        .calendar-day.low {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.4);
        }

        /* Daily Report Modal */
        .daily-report-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 23, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .daily-report-modal.active {
            display: flex;
        }

        .daily-report {
            background: var(--bg-panel);
            border: 2px solid var(--accent-primary);
            border-radius: 20px;
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: reportAppear 0.5s ease;
        }

        @keyframes reportAppear {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .daily-report h2 {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-align: center;
        }

        .report-date {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .report-section {
            margin-bottom: 2rem;
        }

        .report-section h3 {
            font-size: 1.25rem;
            color: var(--accent-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .report-stat-label {
            color: var(--text-secondary);
        }

        .report-stat-value {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--accent-primary);
        }

        .motivation-message {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(124, 58, 237, 0.1));
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .close-report-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .close-report-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        .daily-summary {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .summary-stat {
            margin-bottom: 1.5rem;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .summary-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .disabled-quest {
            opacity: 0.3;
            pointer-events: none;
        }

        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--bg-panel);
            border: 2px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: levelUpAppear 0.5s ease forwards;
        }

        @keyframes levelUpAppear {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .level-up-notification h2 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .stats-panel {
                position: relative;
                top: 0;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.25rem;
            }

            .calendar-day {
                font-size: 0.75rem;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>Life Quest System</h1>
            <p>Rise through consistency. Track your journey. Level up your life.</p>
            <button class="google-btn" onclick="signInWithGoogle()">
                <svg class="google-icon" viewBox="0 0 24 24">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Continue with Google
            </button>
        </div>
    </div>

    <!-- Setup Screen -->
    <div class="setup-screen" id="setupScreen">
        <div class="setup-box">
            <h2>Welcome, Hunter!</h2>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                Let's set up your profile to begin your journey.
            </p>
            <form id="setupForm" onsubmit="completeSetup(event)">
                <div class="form-group">
                    <label>Current Weight (lbs)</label>
                    <input type="number" id="currentWeight" required step="0.1" min="0" placeholder="Enter current weight">
                </div>
                <div class="form-group">
                    <label>Goal Weight (lbs)</label>
                    <input type="number" id="goalWeight" required step="0.1" min="0" placeholder="Enter goal weight">
                </div>
                <button type="submit" class="btn" style="width: 100%; margin-top: 1rem;">
                    Begin Your Journey
                </button>
            </form>
        </div>
    </div>

    <!-- Daily Report Modal -->
    <div class="daily-report-modal" id="dailyReportModal">
        <div class="daily-report">
            <h2>Daily Report</h2>
            <p class="report-date" id="reportDate"></p>
            
            <div class="motivation-message" id="motivationMessage"></div>
            
            <div class="report-section">
                <h3>üìä Quest Completion</h3>
                <div class="report-stat">
                    <span class="report-stat-label">Quests Completed</span>
                    <span class="report-stat-value" id="reportCompletedQuests">0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">Completion Rate</span>
                    <span class="report-stat-value" id="reportCompletionRate">0%</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">Total XP Earned</span>
                    <span class="report-stat-value" id="reportTotalXP">0</span>
                </div>
            </div>

            <div class="report-section">
                <h3>üìà Stat Growth</h3>
                <div class="report-stat">
                    <span class="report-stat-label">üí™ Strength</span>
                    <span class="report-stat-value" id="reportStrengthGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">‚ù§Ô∏è Vitality</span>
                    <span class="report-stat-value" id="reportVitalityGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">üß† Intelligence</span>
                    <span class="report-stat-value" id="reportIntelligenceGain">+0</span>
                </div>
                <div class="report-stat">
                    <span class="report-stat-label">‚òØÔ∏è Balance</span>
                    <span class="report-stat-value" id="reportBalanceGain">+0</span>
                </div>
            </div>

            <div class="report-section">
                <h3>üî• Streak</h3>
                <div class="report-stat">
                    <span class="report-stat-label">Current Streak</span>
                    <span class="report-stat-value" id="reportStreak">0 days</span>
                </div>
            </div>

            <button class="close-report-btn" onclick="closeDailyReport()">Continue</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="container hidden" id="mainApp">
        <div class="header">
            <div class="header-left">
                <h1>Life Quest System</h1>
                <p class="subtitle">Rise Through Consistency</p>
            </div>
            <div class="user-profile" id="userProfile">
                <!-- User info will be inserted here -->
            </div>
        </div>

        <div class="work-schedule-input">
            <div class="input-group">
                <div class="input-field">
                    <label>Work Start Time</label>
                    <input type="time" id="workStart" />
                </div>
                <div class="input-field">
                    <label>Work End Time</label>
                    <input type="time" id="workEnd" />
                </div>
                <button class="btn" onclick="setWorkSchedule()">Set Work Schedule</button>
                <button class="btn btn-clear" onclick="clearWorkSchedule()">Clear</button>
            </div>
        </div>

        <div class="work-schedule-banner" id="workBanner">
            <span class="work-icon">üíº</span>
            <div>
                <strong>Work Mode Active</strong>
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem;">
                    Some quests are disabled during work hours
                </p>
            </div>
        </div>

        <!-- Calendar Heatmap -->
        <div class="calendar-section">
            <h2 class="calendar-header">üî• Your Journey - Last 28 Days</h2>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar days will be generated here -->
            </div>
        </div>

        <div class="dashboard">
            <div class="stats-panel">
                <div class="player-level">
                    <div class="level-display" id="playerLevel">1</div>
                    <div class="level-label">Hunter Level</div>
                    <div class="xp-bar">
                        <div class="xp-label">
                            <span>XP</span>
                            <span id="xpText">0 / 100</span>
                        </div>
                        <div class="xp-progress">
                            <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>üí™ Strength</span>
                        <span class="stat-value" id="strengthValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="strengthBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>‚ù§Ô∏è Vitality</span>
                        <span class="stat-value" id="vitalityValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="vitalityBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>üß† Intelligence</span>
                        <span class="stat-value" id="intelligenceValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="intelligenceBar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-name">
                        <span>‚òØÔ∏è Balance</span>
                        <span class="stat-value" id="balanceValue">0</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill" id="balanceBar" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Weight Tracker -->
                <div class="weight-tracker">
                    <div class="weight-header">
                        <span class="weight-title">‚öñÔ∏è Weight Progress</span>
                    </div>
                    <div class="weight-stats">
                        <div class="weight-stat">
                            <div class="weight-stat-label">Current</div>
                            <div class="weight-stat-value" id="currentWeightDisplay">--</div>
                        </div>
                        <div class="weight-stat">
                            <div class="weight-stat-label">Goal</div>
                            <div class="weight-stat-value" id="goalWeightDisplay">--</div>
                        </div>
                        <div class="weight-stat">
                            <div class="weight-stat-label">Progress</div>
                            <div class="weight-stat-value" id="weightProgressDisplay">0%</div>
                        </div>
                    </div>
                    <div class="weight-progress">
                        <div class="weight-progress-fill" id="weightProgressBar" style="width: 0%"></div>
                    </div>
                    <div class="weight-input-group">
                        <input type="number" id="weeklyWeightInput" placeholder="Weekly check-in" step="0.1">
                        <button class="btn-small" onclick="updateWeight()">Update</button>
                    </div>
                </div>

                <div class="streak-display">
                    <div class="streak-number" id="streakNumber">0</div>
                    <div class="streak-label">Day Streak üî•</div>
                </div>
            </div>

            <div class="quests-section" id="questsContainer">
                <!-- Quests will be generated here -->
            </div>
        </div>

        <div class="daily-summary">
            <div class="summary-stat">
                <div class="summary-value" id="completedToday">0</div>
                <div class="summary-label">Quests Completed Today</div>
            </div>
            <div class="summary-stat">
                <div class="summary-value" id="totalXpToday">0</div>
                <div class="summary-label">Total XP Earned</div>
            </div>
            <button class="btn" onclick="showDailyReport()" style="margin-top: 1rem;">
                View Today's Report
            </button>
        </div>
    </div>

    <script>
        // Firebase Configuration - REPLACE WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let gameState = {
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            stats: {
                strength: 0,
                vitality: 0,
                intelligence: 0,
                balance: 0
            },
            streak: 0,
            lastCompletionDate: null,
            completedQuests: [],
            workSchedule: null,
            notificationsEnabled: false,
            notifiedQuests: [],
            weight: {
                current: 0,
                goal: 0,
                history: []
            },
            dailyHistory: {}, // Store completion data for each day
            statsBeforeToday: {
                strength: 0,
                vitality: 0,
                intelligence: 0,
                balance: 0
            }
        };

        // Quest definitions
        const questCategories = [
            {
                name: "Morning Routine",
                icon: "üåÖ",
                quests: [
                    { id: "wake-up", name: "Wake up at 8:30 AM", time: "08:30", xp: 10, stats: ["vitality"], workBlocked: false },
                    { id: "morning-hydration", name: "Drink water (500ml)", time: "08:45", xp: 5, stats: ["vitality"], workBlocked: false },
                    { id: "morning-meditation", name: "Morning meditation", time: "09:00", xp: 15, stats: ["balance"], workBlocked: false }
                ]
            },
            {
                name: "Fitness & Health",
                icon: "üí™",
                quests: [
                    { id: "daily-run", name: "Daily run (any distance)", time: "09:30", xp: 20, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "workout-1", name: "First workout session (30min)", time: "10:00", xp: 25, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "workout-2", name: "Second workout session (30min)", time: "18:00", xp: 25, stats: ["strength", "vitality"], workBlocked: true },
                    { id: "yoga", name: "Yoga practice", time: "20:00", xp: 20, stats: ["balance", "strength"], workBlocked: true }
                ]
            },
            {
                name: "Nutrition",
                icon: "üçΩÔ∏è",
                quests: [
                    { id: "breakfast", name: "Healthy breakfast", time: "09:30", xp: 15, stats: ["vitality"], workBlocked: false },
                    { id: "lunch", name: "Nutritious lunch", time: "13:00", xp: 15, stats: ["vitality"], workBlocked: false },
                    { id: "dinner", name: "Balanced dinner", time: "19:00", xp: 15, stats: ["vitality"], workBlocked: false },
                    { id: "hydration", name: "Daily water intake (2L)", time: "All day", xp: 10, stats: ["vitality"], workBlocked: false }
                ]
            },
            {
                name: "Productivity & Growth",
                icon: "üìö",
                quests: [
                    { id: "focused-work", name: "Focused work session", time: "Work hours", xp: 20, stats: ["intelligence"], workBlocked: false },
                    { id: "learning", name: "Learning/skill development (30min)", time: "17:00", xp: 25, stats: ["intelligence"], workBlocked: true },
                    { id: "creative-hobby", name: "Creative hobby time", time: "20:30", xp: 20, stats: ["intelligence", "balance"], workBlocked: true }
                ]
            },
            {
                name: "Environment",
                icon: "‚ú®",
                quests: [
                    { id: "tidy-space", name: "Tidy workspace/living area", time: "21:00", xp: 15, stats: ["balance"], workBlocked: true },
                    { id: "deep-clean", name: "Deep clean one area", time: "Flexible", xp: 10, stats: ["balance"], workBlocked: true }
                ]
            },
            {
                name: "Evening Routine",
                icon: "üåô",
                quests: [
                    { id: "evening-reflection", name: "Daily reflection/journaling", time: "22:00", xp: 15, stats: ["intelligence", "balance"], workBlocked: false },
                    { id: "screen-off", name: "Screen-free time (1hr before bed)", time: "22:59", xp: 10, stats: ["balance"], workBlocked: false },
                    { id: "sleep", name: "Sleep by 11:59 PM", time: "23:59", xp: 20, stats: ["vitality", "balance"], workBlocked: false }
                ]
            }
        ];

        // Auth state observer
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                loadUserData();
            } else {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        // Google Sign In
        async function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error('Error signing in:', error);
                alert('Error signing in. Please try again.');
            }
        }

        // Sign Out
        async function signOut() {
            if (confirm('Are you sure you want to sign out?')) {
                await auth.signOut();
                location.reload();
            }
        }

        // Load user data from Firestore
        async function loadUserData() {
            const docRef = db.collection('users').doc(currentUser.uid);
            const doc = await docRef.get();

            if (doc.exists) {
                const data = doc.data();
                gameState = { ...gameState, ...data };
                
                // Check if it's a new day
                const today = new Date().toDateString();
                if (gameState.lastCompletionDate !== today) {
                    // Save yesterday's stats before resetting
                    gameState.statsBeforeToday = { ...gameState.stats };
                    
                    // Reset daily quests
                    gameState.completedQuests = [];
                    
                    // Check streak
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    if (gameState.lastCompletionDate !== yesterday.toDateString()) {
                        gameState.streak = 0;
                    }
                    
                    await saveUserData();
                }
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                renderUserProfile();
                updateUI();
                renderCalendar();
            } else {
                // New user - show setup
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('setupScreen').style.display = 'flex';
            }
        }

        // Complete setup
        async function completeSetup(event) {
            event.preventDefault();
            const currentWeight = parseFloat(document.getElementById('currentWeight').value);
            const goalWeight = parseFloat(document.getElementById('goalWeight').value);
            
            gameState.weight.current = currentWeight;
            gameState.weight.goal = goalWeight;
            gameState.weight.history = [{
                date: new Date().toISOString(),
                weight: currentWeight
            }];
            
            await saveUserData();
            
            document.getElementById('setupScreen').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
            renderUserProfile();
            updateUI();
            renderCalendar();
        }

        // Save user data to Firestore
        async function saveUserData() {
            if (!currentUser) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).set(gameState);
            } catch (error) {
                console.error('Error saving data:', error);
            }
        }

        // Render user profile
        function renderUserProfile() {
            const profile = document.getElementById('userProfile');
            profile.innerHTML = `
                <img src="${currentUser.photoURL}" alt="Profile" class="user-avatar">
                <div class="user-info">
                    <div class="user-name">${currentUser.displayName}</div>
                    <div class="user-email">${currentUser.email}</div>
                </div>
                <button class="logout-btn" onclick="signOut()">Sign Out</button>
            `;
        }

        // Set work schedule
        function setWorkSchedule() {
            const start = document.getElementById('workStart').value;
            const end = document.getElementById('workEnd').value;
            
            if (start && end) {
                gameState.workSchedule = { start, end };
                saveUserData();
                updateUI();
                checkWorkMode();
            }
        }

        function clearWorkSchedule() {
            gameState.workSchedule = null;
            document.getElementById('workStart').value = '';
            document.getElementById('workEnd').value = '';
            saveUserData();
            updateUI();
        }

        // Check if currently in work mode
        function checkWorkMode() {
            if (!gameState.workSchedule) {
                document.getElementById('workBanner').classList.remove('active');
                return false;
            }

            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const [startHour, startMin] = gameState.workSchedule.start.split(':').map(Number);
            const [endHour, endMin] = gameState.workSchedule.end.split(':').map(Number);
            
            const startTime = startHour * 60 + startMin;
            const endTime = endHour * 60 + endMin;
            
            const isWorkTime = currentTime >= startTime && currentTime <= endTime;
            
            if (isWorkTime) {
                document.getElementById('workBanner').classList.add('active');
            } else {
                document.getElementById('workBanner').classList.remove('active');
            }
            
            return isWorkTime;
        }

        // Complete quest
        function completeQuest(questId, quest) {
            if (gameState.completedQuests.includes(questId)) {
                return; // Already completed
            }
            
            gameState.completedQuests.push(questId);
            gameState.xp += quest.xp;
            
            // Add stats
            quest.stats.forEach(stat => {
                gameState.stats[stat] += 2;
            });
            
            // Update completion date and streak
            const today = new Date().toDateString();
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (gameState.lastCompletionDate === yesterday.toDateString()) {
                gameState.streak += 1;
            } else if (gameState.lastCompletionDate !== today) {
                gameState.streak = 1;
            }
            
            gameState.lastCompletionDate = today;
            
            // Store daily completion data
            if (!gameState.dailyHistory[today]) {
                gameState.dailyHistory[today] = {
                    completed: [],
                    total: questCategories.reduce((sum, cat) => sum + cat.quests.length, 0)
                };
            }
            gameState.dailyHistory[today].completed = [...gameState.completedQuests];
            
            // Check level up
            while (gameState.xp >= gameState.xpToNextLevel) {
                levelUp();
            }
            
            saveUserData();
            updateUI();
            renderCalendar();
        }

        // Level up
        function levelUp() {
            gameState.xp -= gameState.xpToNextLevel;
            gameState.level += 1;
            gameState.xpToNextLevel = Math.floor(gameState.xpToNextLevel * 1.5);
            
            // Boost all stats
            Object.keys(gameState.stats).forEach(stat => {
                gameState.stats[stat] += 5;
            });
            
            showLevelUpNotification();
        }

        function showLevelUpNotification() {
            const notification = document.createElement('div');
            notification.className = 'level-up-notification';
            notification.innerHTML = `
                <h2>LEVEL UP!</h2>
                <p style="font-size: 1.5rem; color: var(--text-secondary);">You've reached Level ${gameState.level}</p>
                <p style="margin-top: 1rem; color: var(--accent-primary);">All stats increased!</p>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Update weight
        function updateWeight() {
            const newWeight = parseFloat(document.getElementById('weeklyWeightInput').value);
            if (!newWeight || newWeight <= 0) return;
            
            gameState.weight.current = newWeight;
            gameState.weight.history.push({
                date: new Date().toISOString(),
                weight: newWeight
            });
            
            document.getElementById('weeklyWeightInput').value = '';
            saveUserData();
            updateUI();
        }

        // Render calendar heatmap
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const today = new Date();
            
            for (let i = 27; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toDateString();
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                
                const dayNumber = date.getDate();
                
                let percentage = 0;
                let className = '';
                
                if (gameState.dailyHistory[dateStr]) {
                    const completed = gameState.dailyHistory[dateStr].completed.length;
                    const total = gameState.dailyHistory[dateStr].total;
                    percentage = Math.round((completed / total) * 100);
                    
                    if (percentage >= 80) {
                        className = 'perfect';
                    } else if (percentage >= 60) {
                        className = 'high';
                    } else if (percentage >= 40) {
                        className = 'medium';
                    } else if (percentage > 0) {
                        className = 'low';
                    }
                }
                
                dayDiv.className = `calendar-day ${className}`;
                dayDiv.innerHTML = `
                    <div class="calendar-day-number">${dayNumber}</div>
                    ${percentage > 0 ? `<div class="calendar-day-percentage">${percentage}%</div>` : ''}
                `;
                
                dayDiv.title = `${dateStr}: ${percentage}% complete`;
                
                grid.appendChild(dayDiv);
            }
        }

        // Show daily report
        function showDailyReport() {
            const today = new Date().toDateString();
            const totalQuests = questCategories.reduce((sum, cat) => sum + cat.quests.length, 0);
            const completedQuests = gameState.completedQuests.length;
            const completionRate = Math.round((completedQuests / totalQuests) * 100);
            
            const totalXp = gameState.completedQuests.reduce((sum, id) => {
                const quest = questCategories.flatMap(c => c.quests).find(q => q.id === id);
                return sum + (quest ? quest.xp : 0);
            }, 0);
            
            // Calculate stat gains
            const strengthGain = gameState.stats.strength - gameState.statsBeforeToday.strength;
            const vitalityGain = gameState.stats.vitality - gameState.statsBeforeToday.vitality;
            const intelligenceGain = gameState.stats.intelligence - gameState.statsBeforeToday.intelligence;
            const balanceGain = gameState.stats.balance - gameState.statsBeforeToday.balance;
            
            // Motivational messages
            const messages = [
                "Incredible work today, Hunter! Your consistency is your greatest strength.",
                "Every quest completed brings you closer to your goals. Keep pushing!",
                "You're building something amazing, one day at a time.",
                "The path to greatness is walked daily. You're on it!",
                "Your dedication today shapes your success tomorrow.",
                "Small steps lead to big transformations. You're proving it!",
                "Excellence is a habit, and you're cultivating it beautifully.",
                "Your future self will thank you for today's efforts."
            ];
            
            const motivation = messages[Math.floor(Math.random() * messages.length)];
            
            document.getElementById('reportDate').textContent = new Date().toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('motivationMessage').textContent = motivation;
            document.getElementById('reportCompletedQuests').textContent = `${completedQuests} / ${totalQuests}`;
            document.getElementById('reportCompletionRate').textContent = `${completionRate}%`;
            document.getElementById('reportTotalXP').textContent = totalXp;
            
            document.getElementById('reportStrengthGain').textContent = `+${strengthGain}`;
            document.getElementById('reportVitalityGain').textContent = `+${vitalityGain}`;
            document.getElementById('reportIntelligenceGain').textContent = `+${intelligenceGain}`;
            document.getElementById('reportBalanceGain').textContent = `+${balanceGain}`;
            
            document.getElementById('reportStreak').textContent = `${gameState.streak} days`;
            
            document.getElementById('dailyReportModal').classList.add('active');
        }

        function closeDailyReport() {
            document.getElementById('dailyReportModal').classList.remove('active');
        }

        // Render quests
        function renderQuests() {
            const container = document.getElementById('questsContainer');
            container.innerHTML = '';
            
            const isWorkTime = checkWorkMode();
            
            questCategories.forEach(category => {
                const completed = category.quests.filter(q => 
                    gameState.completedQuests.includes(q.id)
                ).length;
                
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'quest-category';
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <span class="category-icon">${category.icon}</span>
                        <h2 class="category-title">${category.name}</h2>
                        <span class="category-progress">${completed}/${category.quests.length}</span>
                    </div>
                `;
                
                category.quests.forEach(quest => {
                    const isCompleted = gameState.completedQuests.includes(quest.id);
                    const isBlocked = isWorkTime && quest.workBlocked;
                    
                    const questDiv = document.createElement('div');
                    questDiv.className = `quest-item ${isCompleted ? 'completed' : ''} ${isBlocked ? 'disabled-quest' : ''}`;
                    questDiv.innerHTML = `
                        <div class="quest-checkbox"></div>
                        <div class="quest-content">
                            <div class="quest-name">${quest.name}</div>
                            <div class="quest-time">${quest.time}${isBlocked ? ' - Blocked during work' : ''}</div>
                        </div>
                        <div class="quest-xp">+${quest.xp} XP</div>
                    `;
                    
                    if (!isBlocked) {
                        questDiv.onclick = () => completeQuest(quest.id, quest);
                    }
                    
                    categoryDiv.appendChild(questDiv);
                });
                
                container.appendChild(categoryDiv);
            });
        }

        // Update UI
        function updateUI() {
            // Level and XP
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('xpText').textContent = `${gameState.xp} / ${gameState.xpToNextLevel}`;
            const xpPercent = (gameState.xp / gameState.xpToNextLevel) * 100;
            document.getElementById('xpFill').style.width = `${xpPercent}%`;
            
            // Stats
            ['strength', 'vitality', 'intelligence', 'balance'].forEach(stat => {
                const value = gameState.stats[stat];
                document.getElementById(`${stat}Value`).textContent = value;
                document.getElementById(`${stat}Bar`).style.width = `${Math.min(value, 100)}%`;
            });
            
            // Weight tracker
            document.getElementById('currentWeightDisplay').textContent = gameState.weight.current.toFixed(1);
            document.getElementById('goalWeightDisplay').textContent = gameState.weight.goal.toFixed(1);
            
            const startWeight = gameState.weight.history[0]?.weight || gameState.weight.current;
            const totalChange = Math.abs(gameState.weight.goal - startWeight);
            const currentChange = Math.abs(gameState.weight.current - startWeight);
            const weightProgress = totalChange > 0 ? Math.round((currentChange / totalChange) * 100) : 0;
            
            document.getElementById('weightProgressDisplay').textContent = `${weightProgress}%`;
            document.getElementById('weightProgressBar').style.width = `${weightProgress}%`;
            
            // Streak
            document.getElementById('streakNumber').textContent = gameState.streak;
            
            // Daily summary
            document.getElementById('completedToday').textContent = gameState.completedQuests.length;
            const totalXp = gameState.completedQuests.reduce((sum, id) => {
                const quest = questCategories.flatMap(c => c.quests).find(q => q.id === id);
                return sum + (quest ? quest.xp : 0);
            }, 0);
            document.getElementById('totalXpToday').textContent = totalXp;
            
            // Work schedule inputs
            if (gameState.workSchedule) {
                document.getElementById('workStart').value = gameState.workSchedule.start;
                document.getElementById('workEnd').value = gameState.workSchedule.end;
            }
            
            renderQuests();
        }

        // Check work mode every minute
        setInterval(checkWorkMode, 60000);
    </script>
</body>
</html>